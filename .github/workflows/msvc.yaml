name: Continuous Integration

on: [push, pull_request]

jobs:
  ci-msvc:
    name: CI with MSVC
    runs-on: windows-latest

    steps:
    - name: Fetch Sources
      uses: actions/checkout@v2
    - name: Setup Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
    - name: Install Python Dependencies
      run: pip install meson ninja
    - name: Prepare MSVC
      uses: bus1/cabuild/action/msdevshell@v1
      with:
        architecture: x64
    - name: Prepare Build
      run: meson setup build --buildtype=release
    - name: Run Build
      run: meson install -C build --destdir ./artifact
    # - name: Run Test Suite
    #   run: meson test -v -C build
    - name: Upload Build Artifacts
      # Action to upload the resulting binaries
      uses: actions/upload-artifact@v4
      with:
        name: msvc-build
        path: ${{ github.workspace }}/build/artifact/
        # Optional: Keep the artifacts for a set number of days
        retention-days: 7